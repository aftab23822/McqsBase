"use strict";(()=>{var e={};e.id=2241,e.ids=[2241],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},19639:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>w,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var t={};r.r(t),r.d(t,{POST:()=>p});var n=r(49303),a=r(88716),o=r(60670),i=r(87070),u=r(57258),c=r(96064);async function d(e){try{let s=await e.json(),r=await (0,c.f5)(e.user.userId,s);if(!r.success)return i.NextResponse.json({success:r.success,message:r.message},{status:r.status||400});return i.NextResponse.json(r)}catch(e){return console.error("Change password API error:",e),i.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}let p=(0,u.c2)(d),m=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/change-password/route",pathname:"/api/admin/change-password",filename:"route",bundlePath:"app/api/admin/change-password/route"},resolvedPagePath:"E:\\2.Freelance\\mcqs\\next-js\\app\\api\\admin\\change-password\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:h}=m,w="/api/admin/change-password/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},81938:(e,s,r)=>{r.d(s,{Q:()=>o});var t=r(11185);if(!process.env.ADMIN_MONGO_URI&&!process.env.MONGO_URI)throw Error("Please define the ADMIN_MONGO_URI or MONGO_URI environment variable inside .env.local");let n=process.env.ADMIN_MONGO_URI||process.env.MONGO_URI?.replace("/mcqs","/admindb")||"mongodb://localhost:27017/admindb",a=null,o=async()=>{try{return a||(a=await t.createConnection(n,{bufferCommands:!1})),a}catch(e){throw console.error("Admin database connection error:",e),e}}},96064:(e,s,r)=>{r.d(s,{T:()=>i,cW:()=>o,f5:()=>u});var t=r(41482);r(25163);var n=r(81938);async function a(){let e=await (0,n.Q)(),s=new(await Promise.resolve().then(r.t.bind(r,11185,19))).Schema({username:{type:String,required:!0,unique:!0,trim:!0},password:{type:String,required:!0},role:{type:String,default:"admin",enum:["admin","super_admin"]},email:{type:String,required:!1,unique:!0,sparse:!0},isActive:{type:Boolean,default:!0},lastLogin:{type:Date},permissions:[{type:String,enum:["upload_mcqs","manage_users","review_submissions","manage_categories"]}]},{timestamps:!0});return s.pre("save",async function(e){if(!this.isModified("password"))return e();try{let s=await r.e(2023).then(r.t.bind(r,42023,19)),t=await s.genSalt(10);this.password=await s.hash(this.password,t),e()}catch(s){e(s)}}),s.methods.comparePassword=async function(e){return(await r.e(2023).then(r.t.bind(r,42023,19))).compare(e,this.password)},s.methods.toPublicJSON=function(){return{id:this._id,username:this.username,role:this.role,email:this.email,permissions:this.permissions,lastLogin:this.lastLogin,createdAt:this.createdAt}},e.models.AdminUser||e.model("AdminUser",s)}async function o(e){try{let{username:s,password:r}=e;if(!s||!r)return{success:!1,message:"Username and password are required",status:400};let n=await a(),o=await n.findOne({username:s,isActive:!0});if(!o||!await o.comparePassword(r))return{success:!1,message:"Invalid credentials",status:401};o.lastLogin=new Date,await o.save();let i=t.sign({userId:o._id,username:o.username,role:o.role,permissions:o.permissions},process.env.JWT_SECRET,{expiresIn:"24h"});return{success:!0,message:"Login successful",token:i,user:o.toPublicJSON()}}catch(e){return console.error("Login error:",e),{success:!1,message:"Internal server error",status:500}}}async function i(e){try{let s=await a(),r=await s.findById(e);if(!r)return{success:!1,message:"Admin user not found",status:404};return{success:!0,data:r.toPublicJSON()}}catch(e){return console.error("Get profile error:",e),{success:!1,message:"Internal server error",status:500}}}async function u(e,{currentPassword:s,newPassword:r}){try{if(!s||!r)return{success:!1,message:"Current password and new password are required",status:400};let t=await a(),n=await t.findById(e);if(!n)return{success:!1,message:"Admin user not found",status:404};if(!await n.comparePassword(s))return{success:!1,message:"Current password is incorrect",status:400};return n.password=r,await n.save(),{success:!0,message:"Password changed successfully"}}catch(e){return console.error("Change password error:",e),{success:!1,message:"Internal server error",status:500}}}},57258:(e,s,r)=>{r.d(s,{c2:()=>a});var t=r(41482),n=r(87070);function a(e){return async(s,r)=>{let a=function(e){let s=e.headers.get("authorization");if(!s||!s.startsWith("Bearer "))return{error:{message:"No token provided"},status:401};let r=s.split(" ")[1];try{let e=t.verify(r,process.env.JWT_SECRET);if("admin"!==e.role)return{error:{message:"Forbidden: Admins only"},status:403};return{user:e}}catch(e){return{error:{message:"Invalid or expired token"},status:401}}}(s);return a.error?n.NextResponse.json(a.error,{status:a.status}):(s.user=a.user,e(s,r))}}},25163:(e,s,r)=>{r.d(s,{Z:()=>o});var t=r(11185);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable inside .env.local");let n=process.env.MONGO_URI,a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let o=async function(){if(a.conn)return a.conn;a.promise||(a.promise=t.connect(n,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[9276,5972,1482],()=>r(19639));module.exports=t})();