"use strict";(()=>{var e={};e.id=2672,e.ids=[2672],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},99170:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m});var t={};r.r(t),r.d(t,{POST:()=>c});var n=r(49303),a=r(88716),i=r(60670),o=r(87070),u=r(96064);async function c(e){try{let s=await e.json(),r=await (0,u.cW)(s);if(!r.success)return o.NextResponse.json({success:r.success,message:r.message},{status:r.status||400});return o.NextResponse.json(r)}catch(e){return console.error("Admin login API error:",e),o.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/login/route",pathname:"/api/admin/login",filename:"route",bundlePath:"app/api/admin/login/route"},resolvedPagePath:"E:\\2.Freelance\\mcqs\\next-js\\app\\api\\admin\\login\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:p}=d,g="/api/admin/login/route";function h(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}},81938:(e,s,r)=>{r.d(s,{Q:()=>i});var t=r(11185);if(!process.env.ADMIN_MONGO_URI&&!process.env.MONGO_URI)throw Error("Please define the ADMIN_MONGO_URI or MONGO_URI environment variable inside .env.local");let n=process.env.ADMIN_MONGO_URI||process.env.MONGO_URI?.replace("/mcqs","/admindb")||"mongodb://localhost:27017/admindb",a=null,i=async()=>{try{return a||(a=await t.createConnection(n,{bufferCommands:!1})),a}catch(e){throw console.error("Admin database connection error:",e),e}}},96064:(e,s,r)=>{r.d(s,{T:()=>o,cW:()=>i,f5:()=>u});var t=r(41482);r(25163);var n=r(81938);async function a(){let e=await (0,n.Q)(),s=new(await Promise.resolve().then(r.t.bind(r,11185,19))).Schema({username:{type:String,required:!0,unique:!0,trim:!0},password:{type:String,required:!0},role:{type:String,default:"admin",enum:["admin","super_admin"]},email:{type:String,required:!1,unique:!0,sparse:!0},isActive:{type:Boolean,default:!0},lastLogin:{type:Date},permissions:[{type:String,enum:["upload_mcqs","manage_users","review_submissions","manage_categories"]}]},{timestamps:!0});return s.pre("save",async function(e){if(!this.isModified("password"))return e();try{let s=await r.e(2023).then(r.t.bind(r,42023,19)),t=await s.genSalt(10);this.password=await s.hash(this.password,t),e()}catch(s){e(s)}}),s.methods.comparePassword=async function(e){return(await r.e(2023).then(r.t.bind(r,42023,19))).compare(e,this.password)},s.methods.toPublicJSON=function(){return{id:this._id,username:this.username,role:this.role,email:this.email,permissions:this.permissions,lastLogin:this.lastLogin,createdAt:this.createdAt}},e.models.AdminUser||e.model("AdminUser",s)}async function i(e){try{let{username:s,password:r}=e;if(!s||!r)return{success:!1,message:"Username and password are required",status:400};let n=await a(),i=await n.findOne({username:s,isActive:!0});if(!i||!await i.comparePassword(r))return{success:!1,message:"Invalid credentials",status:401};i.lastLogin=new Date,await i.save();let o=t.sign({userId:i._id,username:i.username,role:i.role,permissions:i.permissions},process.env.JWT_SECRET,{expiresIn:"24h"});return{success:!0,message:"Login successful",token:o,user:i.toPublicJSON()}}catch(e){return console.error("Login error:",e),{success:!1,message:"Internal server error",status:500}}}async function o(e){try{let s=await a(),r=await s.findById(e);if(!r)return{success:!1,message:"Admin user not found",status:404};return{success:!0,data:r.toPublicJSON()}}catch(e){return console.error("Get profile error:",e),{success:!1,message:"Internal server error",status:500}}}async function u(e,{currentPassword:s,newPassword:r}){try{if(!s||!r)return{success:!1,message:"Current password and new password are required",status:400};let t=await a(),n=await t.findById(e);if(!n)return{success:!1,message:"Admin user not found",status:404};if(!await n.comparePassword(s))return{success:!1,message:"Current password is incorrect",status:400};return n.password=r,await n.save(),{success:!0,message:"Password changed successfully"}}catch(e){return console.error("Change password error:",e),{success:!1,message:"Internal server error",status:500}}}},25163:(e,s,r)=>{r.d(s,{Z:()=>i});var t=r(11185);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable inside .env.local");let n=process.env.MONGO_URI,a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let i=async function(){if(a.conn)return a.conn;a.promise||(a.promise=t.connect(n,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[9276,5972,1482],()=>r(99170));module.exports=t})();