"use strict";(()=>{var e={};e.id=498,e.ids=[498],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},24082:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var r={};t.r(r),t.d(r,{GET:()=>m});var n=t(49303),a=t(88716),i=t(60670),o=t(87070),u=t(57258),c=t(23144);async function d(e){try{let{searchParams:s}=new URL(e.url),t=Object.fromEntries(s),r=await (0,c.Gm)(t);if(!r.success)return o.NextResponse.json({success:r.success,message:r.message},{status:r.status||500});return o.NextResponse.json(r)}catch(e){return console.error("Get submissions API error:",e),o.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}let m=(0,u.c2)(d),p=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/submissions/route",pathname:"/api/admin/submissions",filename:"route",bundlePath:"app/api/admin/submissions/route"},resolvedPagePath:"E:\\2.Freelance\\mcqs\\next-js\\app\\api\\admin\\submissions\\route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:y}=p,v="/api/admin/submissions/route";function w(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},81938:(e,s,t)=>{t.d(s,{Q:()=>i});var r=t(11185);if(!process.env.ADMIN_MONGO_URI&&!process.env.MONGO_URI)throw Error("Please define the ADMIN_MONGO_URI or MONGO_URI environment variable inside .env.local");let n=process.env.ADMIN_MONGO_URI||process.env.MONGO_URI?.replace("/mcqs","/admindb")||"mongodb://localhost:27017/admindb",a=null,i=async()=>{try{return a||(a=await r.createConnection(n,{bufferCommands:!1})),a}catch(e){throw console.error("Admin database connection error:",e),e}}},23144:(e,s,t)=>{t.d(s,{Gm:()=>i,Gq:()=>a,a_:()=>c,cW:()=>u,ql:()=>o});var r=t(81938);async function n(){let e=await (0,r.Q)(),s=new(await Promise.resolve().then(t.t.bind(t,11185,19))).Schema({type:{type:String,required:!0,enum:["simple","pastpaper","interview"]},question:{type:String,required:!0,trim:!0},options:{A:String,B:String,C:String,D:String,E:String},correctAnswer:{type:String,enum:["A","B","C","D","E"]},answer:String,category:String,username:String,position:String,sharedBy:String,year:Number,department:String,experience:String,status:{type:String,enum:["pending","approved","rejected"],default:"pending"},reviewNotes:String,reviewedBy:String,reviewedAt:Date},{timestamps:!0});return s.index({createdAt:-1}),e.models.UserSubmittedItem||e.model("UserSubmittedItem",s)}async function a(e){try{let{type:s,question:t,optionA:r,optionB:a,optionC:i,optionD:o,optionE:u,correctAnswer:c,category:d,username:m,position:p,sharedBy:l,year:g,department:y,experience:v}=e;if(!s||!t)return{success:!1,message:"Type and question are required",status:400};let w={type:s,question:t};if("interview"===s){if(!p||!l||!g||!y)return{success:!1,message:"Position, shared by, year, and department are required for interview submissions",status:400};w={...w,position:p,sharedBy:l,year:parseInt(g),department:y,experience:v||""}}else{if(!r||!a||!i||!o||!c||!d||!m)return{success:!1,message:"All MCQ fields are required",status:400};w={...w,options:{A:r,B:a,C:i,D:o,E:u||""},correctAnswer:c,category:d,username:m}}let f=new(await n())(w);return await f.save(),{success:!0,message:"Submission received successfully! Our team will review it shortly.",data:{id:f._id,type:f.type,status:f.status}}}catch(e){return console.error("Error submitting item:",e),{success:!1,message:"Internal server error. Please try again later.",status:500}}}async function i(e){try{let s=parseInt(e.page)||1,t=parseInt(e.limit)||10,r=e.status,a=e.type,i={};r&&(i.status=r),a&&(i.type=a);let o=await n(),u=await o.countDocuments(i),c=await o.find(i).sort({createdAt:-1}).skip((s-1)*t).limit(t);return{success:!0,data:{results:c,total:u,page:s,totalPages:Math.ceil(u/t)}}}catch(e){return console.error("Error getting submissions:",e),{success:!1,message:"Internal server error",status:500}}}async function o(e){try{let s=await n(),t=await s.findById(e);if(!t)return{success:!1,message:"Submission not found",status:404};return{success:!0,data:t}}catch(e){return console.error("Error getting submission:",e),{success:!1,message:"Internal server error",status:500}}}async function u(e,{status:s,reviewNotes:t,reviewedBy:r}){try{if(!s||!["pending","approved","rejected"].includes(s))return{success:!1,message:"Valid status is required",status:400};let a={status:s,reviewedAt:new Date};t&&(a.reviewNotes=t),r&&(a.reviewedBy=r);let i=await n(),o=await i.findByIdAndUpdate(e,a,{new:!0});if(!o)return{success:!1,message:"Submission not found",status:404};return{success:!0,message:"Submission status updated successfully",data:o}}catch(e){return console.error("Error updating submission status:",e),{success:!1,message:"Internal server error",status:500}}}async function c(){try{let e=await n(),s=await e.aggregate([{$group:{_id:"$status",count:{$sum:1}}}]),t=await e.aggregate([{$group:{_id:"$type",count:{$sum:1}}}]),r=await e.countDocuments(),a=await e.countDocuments({status:"pending"});return{success:!0,data:{total:r,pending:a,statusBreakdown:s,typeBreakdown:t}}}catch(e){return console.error("Error getting submission stats:",e),{success:!1,message:"Internal server error",status:500}}}},57258:(e,s,t)=>{t.d(s,{c2:()=>a});var r=t(41482),n=t(87070);function a(e){return async(s,t)=>{let a=function(e){let s=e.headers.get("authorization");if(!s||!s.startsWith("Bearer "))return{error:{message:"No token provided"},status:401};let t=s.split(" ")[1];try{let e=r.verify(t,process.env.JWT_SECRET);if("admin"!==e.role)return{error:{message:"Forbidden: Admins only"},status:403};return{user:e}}catch(e){return{error:{message:"Invalid or expired token"},status:401}}}(s);return a.error?n.NextResponse.json(a.error,{status:a.status}):(s.user=a.user,e(s,t))}}}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[9276,5972,1482],()=>t(24082));module.exports=r})();